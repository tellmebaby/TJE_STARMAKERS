<th:block th:fragment="script">
    <!-- js 가져오는 순서 -->
    <!-- jQuery -->
    <!-- jQuery기반 라이브러리 -->
    <!-- 자바스크립트 라이브러리 -->
    <!-- 사용자 정의 자바스크립트 -->
    <!-- <script src="/js/script.js"></script> -->

    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>

    <!-- <script src="/lib/summernote-lite.js"></script> -->
    <!-- <script src="/lib/summernote-ko-KR.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <!-- swiper -->  
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script>

        $(document).ready(function () {

            // 카드이펙트
            $(document).on('mousemove', '.effect', function (e) {
                var container = $(this);
                var overlay = container.find('.card-overlay');

                var x = e.offsetX;
                var y = e.offsetY;
                var rotateY = -1 / 5 * x + 20;
                var rotateX = 4 / 30 * y - 20;

                overlay.css('background-position', `${x / 5 + y / 5}%`);
                container.css('transform', `perspective(350px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`);
            });

            $(document).on('mouseout', '.effect', function () {
                var container = $(this);
                var overlay = container.find('.card-overlay');

                overlay.css('filter', 'opacity(0)');
                container.css('transform', 'perspective(350px) rotateY(0deg) rotateX(0deg)');
            });

            $(document).on('mouseenter', '.effect', function () {
                var overlay = $(this).find('.card-overlay');
                overlay.css('filter', 'opacity(0.8)');
            });

            // 클릭이벤트 처리
            let clickTimer;
            let isDoubleClick = false;

            $(document).on('click', '.card', function () {

                var no = $(this).attr("data-no");

                if (isDoubleClick) {
                    isDoubleClick = false;
                    return;
                }

                clickTimer = setTimeout(() => {
                    if (!isDoubleClick) {
                        window.location="/page/starCard/starRead?starNo="+no;
                    }
                }, 250);
            });

            // 더블클릭
            // $(document).on('dblclick', '.card', function (e) {
            //     clearTimeout(clickTimer);
            //     isDoubleClick = true;

            //     var userNo = "[[${session.user != null ? session.user.userNo : ''}]]";
            //     var starNo = $(this).attr("data-no");
            //     var csrfToken = "[[${_csrf.token}]]";

            //     if (userNo === '') {
            //         alert("로그인을 하시오!");
            //         return;
            //     }

            //     $.ajax({
            //         url: '/page/like', // 서버의 좋아요 상태를 변경하는 API 엔드포인트
            //         method: 'POST',
            //         data: {
            //             userNo: userNo,
            //             starNo: starNo
            //         },
            //         beforeSend: function (xhr) {
            //             // 💍 CSRF 토큰을 요청 헤더에 추가
            //             xhr.setRequestHeader('X-CSRF-TOKEN', csrfToken);
            //         },
            //         success: function (response) {
            //             // 하트 모양 이펙트 추가
            //             // let heart = $('<div class="heart"></div>');
            //             // $('body').append(heart);
            //             // heart.css({
            //             //     top: e.pageY - 25,
            //             //     left: e.pageX - 25
            //             // });

            //             // setTimeout(() => {
            //             //     heart.remove();
            //             // }, 1000);

            //              // 좋아요 아이콘 클래스 토글
            //              $(this).toggleClass('fa-regular fa-solid');
            //         }.bind(this), // this 바인딩
            //         error: function (xhr, status, error) {
            //             console.error("좋아요 상태 변경 실패:", error);
            //         }
            //     });
            // });

            
            // 더블클릭시 좋아요 저장
            function handleCardDoubleClick(cardElement) {
                var $card = $(cardElement); // 현재 클릭된 카드 요소를 저장

                clearTimeout(clickTimer);
                isDoubleClick = true;

                var userNo = "[[${session.user != null ? session.user.userNo : ''}]]";
                var starNo = $card.attr("data-no");
                var csrfToken = "[[${_csrf.token}]]";

                if (userNo === '') {
                    alert("로그인을 하시오!");
                    return;
                }

                // 이벤트 전파 중지 및 기본 동작 방지
                e.preventDefault();
                e.stopPropagation();

                $.ajax({
                    url: '/page/like', // 서버의 좋아요 상태를 변경하는 API 엔드포인트
                    method: 'POST',
                    data: {
                        userNo: userNo,
                        starNo: starNo
                    },
                    beforeSend: function (xhr) {
                        // 💍 CSRF 토큰을 요청 헤더에 추가
                        xhr.setRequestHeader('X-CSRF-TOKEN', csrfToken);
                    },
                    success: function (response) {
                        // 좋아요 아이콘 클래스 토글
                        $card.find('.star-links').toggleClass('liked');
                    },
                    error: function (xhr, status, error) {
                        console.error("좋아요 상태 변경 실패:", error);
                    }
                });
            }



            // 카드 더블클릭 이벤트에 새로운 함수 바인딩
            $(document).on('dblclick', '.card', function (e) {
                // 이벤트 전파 및 기본 동작 방지
                e.preventDefault();
                e.stopPropagation();
                
                // 더블클릭 처리
                handleCardDoubleClick(this); // 이벤트 핸들러 내에서 함수 호출
            });




        });




        $(document).on('click', '.star-links i', function(e) {
            // 아이콘의 클래스 변경
            $(this).toggleClass('fa-regular fa-solid');
            // 별 클릭 알림창 표시
            alert('별 클릭!');


            // 이벤트 전파 및 기본 동작 방지
            e.preventDefault();
            e.stopPropagation();
        });

    </script>

</th:block>