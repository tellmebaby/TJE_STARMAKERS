<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/default_layout}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index Page</title>
    <link rel="stylesheet" href="/css/card.css" class="css">

</head>


<body>
    <div layout:fragment="content">
        <div class="container">
            <form>
                <div class="search-title d-flex justify-content-between mt-3">
                    <span>ìƒì„¸ê²€ìƒ‰</span>
                    <div class="col-4 d-flex justify-content-end">
                        <a href="starCalendar.html" class="btn btn-primary col-4 me-1">ìº˜ë¦°ë”ë³´ê¸°</a>
                        <a href="starInsert.html" class="btn btn-primary col-4 me-1">ë“±ë¡í•˜ê¸°</a>
                    </div>
                </div>
                <div class="detail-search mb-3">
                    <div class="row d-flex align-items-center mb-3">
                        <div class="col-md-12 d-flex align-items-center">
                            <h5>ìƒíƒœ</h5>
                            <div class="form-check form-check-inline ms-4">
                                <input class="form-check-input" type="checkbox" value="" id="eventOngoing">
                                <label class="form-check-label" for="eventOngoing">
                                    ì§„í–‰ì¤‘ì¸ ì´ë²¤íŠ¸
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="eventExpired">
                                <label class="form-check-label" for="eventExpired">
                                    ë§Œë£Œëœ ì´ë²¤íŠ¸
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="eventExpired">
                                <label class="form-check-label" for="eventExpired">
                                    ì§„í–‰ì˜ˆì • ì´ë²¤íŠ¸
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row d-flex align-items-center mb-3">
                        <div class="col-md-12 d-flex align-items-center">
                            <h5>í˜•íƒœ</h5>
                            <div class="form-check form-check-inline ms-4">
                                <input class="form-check-input" type="checkbox" value="" id="instagram">
                                <label class="form-check-label" for="instagram">
                                    ì¸ìŠ¤íƒ€ê·¸ë¨
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="youtube">
                                <label class="form-check-label" for="youtube">
                                    ìœ íŠœë¸Œ
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="chzzk">
                                <label class="form-check-label" for="chzzk">
                                    ì¹˜ì§€ì§
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="afreeca">
                                <label class="form-check-label" for="afreeca">
                                    ì•„í”„ë¦¬ì¹´
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row d-flex align-items-center">
                        <div class="col-md-12 d-flex align-items-center">
                            <h5>ë¶„ì•¼</h5>
                            <div class="form-check form-check-inline ms-4">
                                <input class="form-check-input" type="checkbox" value="" id="food">
                                <label class="form-check-label" for="food">
                                    ìŒì‹
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="travel">
                                <label class="form-check-label" for="travel">
                                    ì—¬í–‰
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="gaming">
                                <label class="form-check-label" for="gaming">
                                    ê²Œì„
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="music">
                                <label class="form-check-label" for="music">
                                    ìŒì•…
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="animals">
                                <label class="form-check-label" for="animals">
                                    ë™ë¬¼
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="exercise">
                                <label class="form-check-label" for="exercise">
                                    ìš´ë™
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="asmr">
                                <label class="form-check-label" for="asmr">
                                    ASMR
                                </label>
                            </div>
                        </div>
                    </div>


                    <div class="row mt-3">
                        <div class="col-md-12 d-flex align-items-center">
                            <input type="text" class="form-control me-2" id="searchInput" placeholder="ê²€ìƒ‰ í‚¤ì›Œë“œ ì…ë ¥">
                            <button type="submit" class="btn btn-primary col-2">ê²€ìƒ‰</button>
                        </div>
                    </div>
                </div>


            </form>


            <div id="promotionCarousel" class="carousel">
                <div class="row mx-0 mb-5">
                    <div class="col-lg-3 p-0" th:each="star : ${starList}">
                        <div class="card" th:classappend="${star.card == 'ìœ ë£Œí™ë³´'} ? ' effect'"
                            th:data-no="${star.starNo}">
                            <div th:if="${star.card == 'ìœ ë£Œí™ë³´'}" class="card-overlay"></div>
                            <img th:src="|/file/img/${star.imgNo}|" class="card-img-top" th:alt="${star.title}">
                            <div class="icon-body">
                                <img th:each="icon : ${star.icons}" th:src="|/img/icon/${icon}.png|"
                                    th:class="|content-icon ${icon}|">
                            </div>
                            <div class="card-body">
                                <h5 class="card-title" th:text="${star.title}">ì œëª© ì—†ìŒ</h5>
                                <p class="card-text" th:text="${star.writer}">ë‚´ìš© ì—†ìŒ</p>
                            </div>
                            <div class="icon-container">
                                <i class="fa-regular fa-thumbs-up icon"></i>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


            <script>
                $(document).ready(function () {

                    $(window).on('scroll', function () {
                        // í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜
                        var scrollTop = $(this).scrollTop();
                        // ë¬¸ì„œì˜ ì´ ë†’ì´
                        var documentHeight = $(document).height();
                        // ì°½ì˜ ë†’ì´
                        var windowHeight = $(this).height();

                        // ì‚¬ìš©ìê°€ í˜ì´ì§€ í•˜ë‹¨ì— ë„ë‹¬í–ˆëŠ”ì§€ í™•ì¸
                        // if (scrollTop + windowHeight >= documentHeight) {
                        //     alert('í˜ì´ì§€ í•˜ë‹¨ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤!');
                        // }
                    });



                    // ì¹´ë“œì´í™íŠ¸
                    $('.effect').each(function () {
                        var container = $(this);
                        var overlay = container.find('.card-overlay');

                        container.on('mousemove', function (e) {
                            var x = e.offsetX;
                            var y = e.offsetY;
                            var rotateY = -1 / 5 * x + 20;
                            var rotateX = 4 / 30 * y - 20;

                            overlay.css('background-position', `${x / 5 + y / 5}%`);
                            container.css('transform', `perspective(350px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`);
                        });

                        container.on('mouseout', function () {
                            overlay.css('filter', 'opacity(0)');
                            container.css('transform', 'perspective(350px) rotateY(0deg) rotateX(0deg)');
                        });

                        container.on('mouseenter', function () {
                            overlay.css('filter', 'opacity(0.8)');
                        });
                    });


                    // í´ë¦­ì´ë²¤íŠ¸ ì²˜ë¦¬
                    let clickTimer;
                    let isDoubleClick = false;

                    $('.card').click(function () {
                        if (isDoubleClick) {
                            isDoubleClick = false;
                            return;
                        }

                        clickTimer = setTimeout(() => {
                            if (!isDoubleClick) {
                                alert('Button was one-clicked!');
                            }
                        }, 250);
                    });


                    // ë”ë¸”í´ë¦­
                    $('.card').dblclick(function (e) {
                        clearTimeout(clickTimer);
                        isDoubleClick = true;


                        var userNo = "[[${session.user.userNo}]]";
                        var starNo = $(this).attr("data-no");
                        var csrfToken = "[[${_csrf.token}]]"

                        if (userNo === 'null' || userNo === '') {
                            alert("ë¡œê·¸ì¸ì„ í•˜ì‹œì˜¤!");
                            return;
                        }

                        $.ajax({
                            url: '/page/like', // ì„œë²„ì˜ ì¢‹ì•„ìš” ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” API ì—”ë“œí¬ì¸íŠ¸
                            method: 'POST',
                            data: {
                                userNo: userNo,
                                starNo: starNo
                            },
                            beforeSend: function (xhr) {
                                // ğŸ’ CSRF í† í°ì„ ìš”ì²­ í—¤ë”ì— ì¶”ê°€
                                xhr.setRequestHeader('X-CSRF-TOKEN', csrfToken);
                            },
                            success: function (response) {
                                // í•˜íŠ¸ ëª¨ì–‘ ì´í™íŠ¸ ì¶”ê°€
                                let heart = $('<div class="heart"></div>');
                                $('body').append(heart);
                                heart.css({
                                    top: e.pageY - 25,
                                    left: e.pageX - 25
                                });

                                setTimeout(() => {
                                    heart.remove();
                                }, 1000);

                                // ì¢‹ì•„ìš” ì•„ì´ì½˜ í´ë˜ìŠ¤ í† ê¸€
                                $(this).find('.fa-thumbs-up').toggleClass('fa-regular fa-solid');
                            }.bind(this), // this ë°”ì¸ë”©
                            error: function (xhr, status, error) {
                                console.error("ì¢‹ì•„ìš” ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨:", error);
                            }
                        });
                    });



                });
            </script>





        </div>
</body>

</html>