<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/default_layout}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index Page</title>
    <link rel="stylesheet" href="/css/card.css" class="css">

</head>


<body>
    <div layout:fragment="content">
        <div class="container">
            <form>
                <div class="search-title d-flex justify-content-between mt-3">
                    <span>상세검색</span>
                    <div class="col-4 d-flex justify-content-end">
                        <a href="starCalendar.html" class="btn btn-primary col-4 me-1">캘린더보기</a>
                        <a href="starInsert.html" class="btn btn-primary col-4 me-1">등록하기</a>
                    </div>
                </div>
                <div class="detail-search mb-3">
                    <div class="row d-flex align-items-center mb-3">
                        <div class="col-md-12 d-flex align-items-center">
                            <h5>상태</h5>
                            <div class="form-check form-check-inline ms-4">
                                <input class="form-check-input" type="checkbox" value="" id="eventOngoing">
                                <label class="form-check-label" for="eventOngoing">
                                    진행중인 이벤트
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="eventExpired">
                                <label class="form-check-label" for="eventExpired">
                                    만료된 이벤트
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="eventExpired">
                                <label class="form-check-label" for="eventExpired">
                                    진행예정 이벤트
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row d-flex align-items-center mb-3">
                        <div class="col-md-12 d-flex align-items-center">
                            <h5>형태</h5>
                            <div class="form-check form-check-inline ms-4">
                                <input class="form-check-input" type="checkbox" value="" id="instagram">
                                <label class="form-check-label" for="instagram">
                                    인스타그램
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="youtube">
                                <label class="form-check-label" for="youtube">
                                    유튜브
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="chzzk">
                                <label class="form-check-label" for="chzzk">
                                    치지직
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="afreeca">
                                <label class="form-check-label" for="afreeca">
                                    아프리카
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row d-flex align-items-center">
                        <div class="col-md-12 d-flex align-items-center">
                            <h5>분야</h5>
                            <div class="form-check form-check-inline ms-4">
                                <input class="form-check-input" type="checkbox" value="" id="food">
                                <label class="form-check-label" for="food">
                                    음식
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="travel">
                                <label class="form-check-label" for="travel">
                                    여행
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="gaming">
                                <label class="form-check-label" for="gaming">
                                    게임
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="music">
                                <label class="form-check-label" for="music">
                                    음악
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="animals">
                                <label class="form-check-label" for="animals">
                                    동물
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="exercise">
                                <label class="form-check-label" for="exercise">
                                    운동
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="asmr">
                                <label class="form-check-label" for="asmr">
                                    ASMR
                                </label>
                            </div>
                        </div>
                    </div>


                    <div class="row mt-3">
                        <div class="col-md-12 d-flex align-items-center">
                            <input type="text" class="form-control me-2" id="searchInput" placeholder="검색 키워드 입력">
                            <button type="submit" class="btn btn-primary col-2">검색</button>
                        </div>
                    </div>
                </div>


            </form>


            <div id="promotionCarousel" class="carousel">
                <div class="row mx-0 mb-5">
                    <div class="col-lg-3 p-0" th:each="star : ${starList}">
                        <div class="card" th:classappend="${star.card == '유료홍보'} ? ' effect'"
                            th:data-no="${star.starNo}">
                            <div th:if="${star.card == '유료홍보'}" class="card-overlay"></div>
                            <img th:src="|/file/img/${star.imgNo}|" class="card-img-top" th:alt="${star.title}">
                            <div class="icon-body">
                                <img th:each="icon : ${star.icons}" th:src="|/img/icon/${icon}.png|"
                                    th:class="|content-icon ${icon}|">
                            </div>
                            <div class="card-body">
                                <h5 class="card-title" th:text="${star.title}">제목 없음</h5>
                                <p class="card-text" th:text="${star.writer}">내용 없음</p>
                            </div>
                            <div class="icon-container">
                                <i class="fa-regular fa-thumbs-up icon"></i>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


            <script>
                $(document).ready(function () {

                    $(window).on('scroll', function () {
                        // 현재 스크롤 위치
                        var scrollTop = $(this).scrollTop();
                        // 문서의 총 높이
                        var documentHeight = $(document).height();
                        // 창의 높이
                        var windowHeight = $(this).height();

                        // 사용자가 페이지 하단에 도달했는지 확인
                        // if (scrollTop + windowHeight >= documentHeight) {
                        //     alert('페이지 하단에 도달했습니다!');
                        // }
                    });



                    // 카드이펙트
                    $('.effect').each(function () {
                        var container = $(this);
                        var overlay = container.find('.card-overlay');

                        container.on('mousemove', function (e) {
                            var x = e.offsetX;
                            var y = e.offsetY;
                            var rotateY = -1 / 5 * x + 20;
                            var rotateX = 4 / 30 * y - 20;

                            overlay.css('background-position', `${x / 5 + y / 5}%`);
                            container.css('transform', `perspective(350px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`);
                        });

                        container.on('mouseout', function () {
                            overlay.css('filter', 'opacity(0)');
                            container.css('transform', 'perspective(350px) rotateY(0deg) rotateX(0deg)');
                        });

                        container.on('mouseenter', function () {
                            overlay.css('filter', 'opacity(0.8)');
                        });
                    });


                    // 클릭이벤트 처리
                    let clickTimer;
                    let isDoubleClick = false;

                    $('.card').click(function () {
                        if (isDoubleClick) {
                            isDoubleClick = false;
                            return;
                        }

                        clickTimer = setTimeout(() => {
                            if (!isDoubleClick) {
                                alert('Button was one-clicked!');
                            }
                        }, 250);
                    });


                    // 더블클릭
                    $('.card').dblclick(function (e) {
                        clearTimeout(clickTimer);
                        isDoubleClick = true;


                        var userNo = "[[${session.user.userNo}]]";
                        var starNo = $(this).attr("data-no");
                        var csrfToken = "[[${_csrf.token}]]"

                        if (userNo === 'null' || userNo === '') {
                            alert("로그인을 하시오!");
                            return;
                        }

                        $.ajax({
                            url: '/page/like', // 서버의 좋아요 상태를 변경하는 API 엔드포인트
                            method: 'POST',
                            data: {
                                userNo: userNo,
                                starNo: starNo
                            },
                            beforeSend: function (xhr) {
                                // 💍 CSRF 토큰을 요청 헤더에 추가
                                xhr.setRequestHeader('X-CSRF-TOKEN', csrfToken);
                            },
                            success: function (response) {
                                // 하트 모양 이펙트 추가
                                let heart = $('<div class="heart"></div>');
                                $('body').append(heart);
                                heart.css({
                                    top: e.pageY - 25,
                                    left: e.pageX - 25
                                });

                                setTimeout(() => {
                                    heart.remove();
                                }, 1000);

                                // 좋아요 아이콘 클래스 토글
                                $(this).find('.fa-thumbs-up').toggleClass('fa-regular fa-solid');
                            }.bind(this), // this 바인딩
                            error: function (xhr, status, error) {
                                console.error("좋아요 상태 변경 실패:", error);
                            }
                        });
                    });



                });
            </script>





        </div>
</body>

</html>