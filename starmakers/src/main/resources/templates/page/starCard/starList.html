<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/default_layout}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index Page</title>
    <link rel="stylesheet" href="/css/card.css" class="css">

</head>


<body>
    <div layout:fragment="content">
        <div class="container">
            <form id="searchForm">
                <div class="search-title d-flex justify-content-between mt-3">
                    <span>상세검색</span>
                    <div class="col-4 d-flex justify-content-end">
                        <a href="starCalendar" class="btn btn-primary col-4 me-1">캘린더보기</a>
                        <a href="starInsert" class="btn btn-primary col-4 me-1">등록하기</a>
                    </div>
                </div>
                <div class="detail-search mb-3">
                    <div class="row d-flex align-items-center mb-3">
                        <div class="col-md-12 d-flex align-items-center">
                            <h5>상태</h5>
                            <div class="form-check form-check-inline ms-4">
                                <input class="form-check-input" type="checkbox" value="" id="eventOngoing" checked>
                                <label class="form-check-label" for="eventOngoing">
                                    진행중인 이벤트
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="eventExpired">
                                <label class="form-check-label" for="eventExpired">
                                    만료된 이벤트
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="eventUpcoming">
                                <label class="form-check-label" for="eventUpcoming">
                                    진행예정 이벤트
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row d-flex align-items-center mb-3">
                        <div class="col-md-12 d-flex align-items-center">
                            <h5>채널</h5>
                            <div class="form-check form-check-inline ms-4">
                                <input class="form-check-input" type="checkbox" value="" id="instagram">
                                <label class="form-check-label" for="instagram">
                                    인스타그램
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="youtube">
                                <label class="form-check-label" for="youtube">
                                    유튜브
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="chzzk">
                                <label class="form-check-label" for="chzzk">
                                    치지직
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="afreeca">
                                <label class="form-check-label" for="afreeca">
                                    아프리카
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row d-flex align-items-center">
                        <div class="col-md-12 d-flex align-items-center">
                            <h5>분야</h5>
                            <div class="form-check form-check-inline ms-4">
                                <input class="form-check-input" type="checkbox" value="" id="food">
                                <label class="form-check-label" for="food">
                                    음식
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="travel">
                                <label class="form-check-label" for="travel">
                                    여행
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="game">
                                <label class="form-check-label" for="game">
                                    게임
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="music">
                                <label class="form-check-label" for="music">
                                    음악
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="animal">
                                <label class="form-check-label" for="animal">
                                    동물
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="workOut">
                                <label class="form-check-label" for="workOut">
                                    운동
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="asmr">
                                <label class="form-check-label" for="asmr">
                                    ASMR
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="fashion">
                                <label class="form-check-label" for="fashion">
                                    패션
                                </label>
                            </div>
                        </div>
                    </div>


                    <div class="row mt-3">
                        <div class="col-md-12 d-flex align-items-center">
                            <input type="text" class="form-control me-2" id="searchInput" placeholder="검색 키워드 입력" th:value="${param.txt}">
                            <button type="submit" class="btn btn-primary col-2">검색</button>
                        </div>
                    </div>
                </div>
            </form>


            <div id="promotionCarousel" class="carousel">
                <div class="row mx-0 mb-5" id="starList">

                </div>

            </div>


            <script>
                $(document).ready(function () {
                    let page = 0;
                    const type = 'starCard';
                    let isLoading = false;

                    function loadMoreCards(resetPage = false) {
                        if (isLoading) return;
                        isLoading = true;

                        if (resetPage) page = 0;
                        page += 1;

                        $.ajax({
                            url: `/page/starCard/starList/api`,
                            method: 'GET',
                            data: {
                                type: type,
                                page: page,
                                eventOngoing: $('#eventOngoing').is(':checked'),
                                eventExpired: $('#eventExpired').is(':checked'),
                                eventUpcoming: $('#eventUpcoming').is(':checked'),
                                instagram: $('#instagram').is(':checked'),
                                youtube: $('#youtube').is(':checked'),
                                chzzk: $('#chzzk').is(':checked'),
                                afreeca: $('#afreeca').is(':checked'),
                                food: $('#food').is(':checked'),
                                travel: $('#travel').is(':checked'),
                                game: $('#game').is(':checked'),
                                music: $('#music').is(':checked'),
                                animal: $('#animal').is(':checked'),
                                workOut: $('#workOut').is(':checked'),
                                asmr: $('#asmr').is(':checked'),
                                fashion: $('#fashion').is(':checked'),
                                keyword: $('#searchInput').val()
                            },
                            success: function (data) {
                                if (resetPage) $('#starList').empty();

                                data.forEach(star => {
                                    const cardHtml = `
                                        <div class="col-lg-3 p-0">
                                            <div class="card ${star.card === '유료홍보' ? 'effect' : ''}" data-no="${star.starNo}">
                                                ${star.card === '유료홍보' ? '<div class="card-overlay"></div>' : ''}
                                                <img src="/file/img/${star.imgNo}" class="card-img-top" alt="${star.title}">
                                                <div class="icon-body">
                                                    ${star.icons.map(icon => `<img src="/img/icon/${icon}.png" class="content-icon ${icon}">`).join('')}
                                                </div>
                                                <div class="card-body">
                                                    <h5 class="card-title">${star.title}</h5>
                                                    <p class="card-text">${star.writer}</p>
                                                </div>
                                                <div class="icon-container">
                                                    <i class="fa-thumbs-up icon ${star.likes_chk ? 'fa-solid' : 'fa-regular'}"></i>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                    $('#starList').append(cardHtml);
                                });
                                isLoading = false;
                            },
                            error: function () {
                                console.error("Failed to load more cards.");
                                isLoading = false;
                            }
                        });
                    }


                    // 초기 카드 로드
                    loadMoreCards();

                    // 스크롤 이벤트
                    $(window).scroll(function () {
                        if ($(window).scrollTop() + $(window).height() >= $(document).height()) {
                            loadMoreCards();
                        }
                    });

                    // 검색 폼 제출 이벤트
                    $('#searchForm').submit(function (event) {
                        event.preventDefault();
                        loadMoreCards(true);
                    });

                    // 체크박스 변경 이벤트
                    $('input[type="checkbox"]').change(function () {
                        loadMoreCards(true);
                    });


                });

            </script>





        </div>
</body>

</html>